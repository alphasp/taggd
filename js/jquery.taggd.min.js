/*!
 * jQuery Taggd
 * A helpful plugin that helps you adding 'tags' on images.
 *
 * License: MIT
 */
(function(n){"use strict";var r={edit:!1,align:{x:"center",y:"center"},handlers:{},offset:{left:0,top:0},strings:{save:"&#x2713;","delete":"&#x00D7;"}},i={show:function(){var t=n(this),i=t.next();t.addClass("active");i.addClass("show").find("input").focus()},hide:function(){var t=n(this);t.removeClass("active");t.next().removeClass("show")},toggle:function(){var t=n(this);t.hasClass("active")?i.hide.call(this):i.show.call(this)}},t=function(t,u,f){var e=this;if(u.edit&&(u.handlers={click:function(){e.hide();i.show.call(this)}}),this.element=n(t),this.options=n.extend(!0,{},r,u),this.data=f,this.initialized=!1,this.element.height()&&this.element.width())this.initialize();else this.element.on("load",e.initialize.bind(this))};t.prototype.initialize=function(){var t=this;if(this.initialized=!0,this.initWrapper(),this.addDOM(),this.options.edit)this.element.on("click",function(i){var r=n(this).parent().offset(),u=(i.pageX-r.left)/t.element.width(),f=(i.pageY-r.top)/t.element.height();t.addData({x:u,y:f,text:""});t.show(t.data.length-1)});n(window).resize(function(){t.updateDOM()})};t.prototype.initWrapper=function(){var t=n('<div class="taggd-wrapper img-center" />');this.element.wrap(t);this.wrapper=this.element.parent(".taggd-wrapper")};t.prototype.alterDOM=function(){var t=this;this.wrapper.find(".taggd-item-hover").each(function(){var i=n(this),r=n('<input type="text" size="16" />').val(i.text()),u=n("<button />").html(t.options.strings.save),f=n("<button />").html(t.options.strings.delete);u.on("click",function(){t.hide()});f.on("click",function(){var r=i.attr("data-x"),u=i.attr("data-y");t.data=n.grep(t.data,function(n){return n.x!=r||n.y!=u});t.addDOM();t.element.triggerHandler("change")});r.on("change",function(){var f=i.attr("data-x"),e=i.attr("data-y"),u=n.grep(t.data,function(n){return n.x==f&&n.y==e}).pop();u&&(u.text=r.val());t.addDOM();t.element.triggerHandler("change")});i.empty().append(r,u,f)});t.updateDOM()};t.prototype.addData=function(t){n.isArray(t)?this.data=n.merge(this.data,t):this.data.push(t);this.initialized&&(this.addDOM(),this.element.triggerHandler("change"))};t.prototype.setData=function(n){this.data=n;this.initialized&&this.addDOM()};t.prototype.clear=function(){this.initialized&&this.wrapper.find(".taggd-item, .taggd-item-hover").remove()};t.prototype.on=function(n,t){if(typeof n=="string"&&typeof t=="function")this.element.on(n,t)};t.prototype.iterateTags=function(t,i){var r;if(n.isNumeric(t))r=function(n){return t===n};else if(typeof t=="string")r=function(i,r){return n(r).is(t)};else if(n.isArray(t))r=function(i,r){var f=n(r),u=!1;return n.each(t,function(n,t){if(i===n||r===t||f.is(t))return u=!0,!1}),u};else if(typeof t=="object")r=function(i,r){var u=n(r);return u.is(t)};else if(n.isFunction(t))r=t;else{if(t)return this;r=function(){return!0}}return this.wrapper.find(".taggd-item").each(function(n,t){typeof i=="function"&&r.call(this,n,t)&&i.call(this,n,t)}),this};t.prototype.show=function(n){return this.iterateTags(n,i.show)};t.prototype.hide=function(n){return this.iterateTags(n,i.hide)};t.prototype.toggle=function(n){return this.iterateTags(n,i.toggle)};t.prototype.dispose=function(){this.clear();this.element.unwrap(this.wrapper)};t.prototype.addDOM=function(){var t=this,r,u;this.clear();this.element.css({height:"auto",width:"auto"});r=this.element.height();u=this.element.width();n.each(this.data,function(f,e){var o=n("<span />"),s;e.x>1&&e.x%1==0&&e.y>1&&e.y%1==0&&(e.x=e.x/u,e.y=e.y/r);typeof e.attributes=="object"&&o.attr(e.attributes);o.attr({"data-x":e.x,"data-y":e.y});o.css("position","absolute");o.addClass("taggd-item");o.addClass("active");o.addClass("animate");t.wrapper.append(o);typeof e.text=="string"&&(e.text.length>0||t.options.edit)&&(s=n('<span class="taggd-item-hover show" style="position: absolute;" />').html(e.text),s.attr({"data-x":e.x,"data-y":e.y}),t.wrapper.append(s));typeof t.options.handlers=="object"&&n.each(t.options.handlers,function(n,r){var u;typeof r=="string"&&i[r]?u=i[r]:typeof r=="function"&&(u=r);o.on(n,function(n){u&&u.call(o,n,t.data[f])})})});this.element.removeAttr("style");this.options.edit&&this.alterDOM();this.updateDOM()};t.prototype.updateDOM=function(){var t=this;this.wrapper.removeAttr("style").css({height:this.element.height(),width:this.element.width()});this.wrapper.find("span").each(function(i,r){var u=n(r),f=u.attr("data-x")*t.element.width(),e=u.attr("data-y")*t.element.height();u.hasClass("taggd-item")?u.css({left:f-u.outerWidth(!0)/2,top:e-u.outerHeight(!0)/2}):u.hasClass("taggd-item-hover")&&(t.options.align.x==="center"?f-=u.outerWidth(!0)/2:t.options.align.x==="right"&&(f-=u.outerWidth(!0)),t.options.align.y==="center"?e-=u.outerHeight(!0)/2:t.options.align.y==="bottom"&&(e-=u.outerHeight(!0)),u.attr("data-align",u.outerWidth(!0)),u.css({left:f+t.options.offset.left,top:e+t.options.offset.top}))})};n.fn.taggd=function(n,i){return new t(this,n,i)}})(jQuery);
//# sourceMappingURL=jquery.taggd.min.js.map
