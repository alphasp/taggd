!function(t){"use strict";var e={edit:!1,align:{x:"center",y:"center"},handlers:{},offset:{left:0,top:0},strings:{save:"&#x2713;","delete":"&#x00D7;"}},i={show:function(){var e=t(this),i=e.next();e.addClass("active"),i.addClass("show").find("input").focus()},hide:function(){var e=t(this);e.removeClass("active"),e.next().removeClass("show")},toggle:function(){var e=t(this);e.hasClass("active")?i.hide.call(this):i.show.call(this)}},a=function(a,n,s){var o=this;n.edit&&(n.handlers={click:function(){o.hide(),i.show.call(this)}}),this.element=t(a),this.options=t.extend(!0,{},e,n),this.data=s,this.initialized=!1,this.element.height()&&this.element.width()?this.initialize():this.element.on("load",o.initialize.bind(this))};a.prototype.initialize=function(){var e=this;this.initialized=!0,this.initWrapper(),this.addDOM(),this.options.edit&&this.element.on("click",function(i){var a=t(this).parent().offset(),n=(i.pageX-a.left)/e.element.width(),s=(i.pageY-a.top)/e.element.height();e.addData({x:n,y:s,text:""}),e.show(e.data.length-1)}),t(window).resize(function(){e.updateDOM()})},a.prototype.initWrapper=function(){var e=t('<div class="taggd-wrapper" />');this.element.wrap(e),this.wrapper=this.element.parent(".taggd-wrapper")},a.prototype.alterDOM=function(){var e=this;this.wrapper.find(".taggd-item-hover").each(function(){var i=t(this),a=t('<input type="text" size="16" />').val(i.text()),n=t("<button />").html(e.options.strings.save),s=t("<button />").html(e.options.strings.delete);n.on("click",function(){e.hide()}),s.on("click",function(){var a=i.attr("data-x"),n=i.attr("data-y");e.data=t.grep(e.data,function(t){return t.x!=a||t.y!=n}),e.addDOM(),e.element.triggerHandler("change")}),a.on("change",function(){var n=i.attr("data-x"),s=i.attr("data-y"),o=t.grep(e.data,function(t){return t.x==n&&t.y==s}).pop();o&&(o.text=a.val()),e.addDOM(),e.element.triggerHandler("change")}),i.empty().append(a,n,s)}),e.updateDOM()},a.prototype.addData=function(e){t.isArray(e)?this.data=t.merge(this.data,e):this.data.push(e),this.initialized&&(this.addDOM(),this.element.triggerHandler("change"))},a.prototype.setData=function(t){this.data=t,this.initialized&&this.addDOM()},a.prototype.clear=function(){this.initialized&&this.wrapper.find(".taggd-item, .taggd-item-hover").remove()},a.prototype.on=function(t,e){"string"==typeof t&&"function"==typeof e&&this.element.on(t,e)},a.prototype.iterateTags=function(e,i){var a;if(t.isNumeric(e))a=function(t){return e===t};else if("string"==typeof e)a=function(i,a){return t(a).is(e)};else if(t.isArray(e))a=function(i,a){var n=t(a),s=!1;return t.each(e,function(t,e){return i===t||a===e||n.is(e)?(s=!0,!1):void 0}),s};else if("object"==typeof e)a=function(i,a){var n=t(a);return n.is(e)};else if(t.isFunction(e))a=e;else{if(e)return this;a=function(){return!0}}return this.wrapper.find(".taggd-item").each(function(t,e){"function"==typeof i&&a.call(this,t,e)&&i.call(this,t,e)}),this},a.prototype.show=function(t){return this.iterateTags(t,i.show)},a.prototype.hide=function(t){return this.iterateTags(t,i.hide)},a.prototype.toggle=function(t){return this.iterateTags(t,i.toggle)},a.prototype.dispose=function(){this.clear(),this.element.unwrap(this.wrapper)},a.prototype.addDOM=function(){var e=this;this.clear(),this.element.css({height:"auto",width:"auto"});var a=this.element.height(),n=this.element.width();t.each(this.data,function(s,o){var r,h=t("<span />");o.x>1&&o.x%1===0&&o.y>1&&o.y%1===0&&(o.x=o.x/n,o.y=o.y/a),"object"==typeof o.attributes&&h.attr(o.attributes),h.attr({"data-x":o.x,"data-y":o.y}),h.css("position","absolute"),h.addClass("taggd-item"),h.addClass("animate"),e.wrapper.append(h),"string"==typeof o.text&&(o.text.length>0||e.options.edit)&&(r=t('<span class="taggd-item-hover" style="position: absolute;" />').html(o.text),r.attr({"data-x":o.x,"data-y":o.y}),e.wrapper.append(r)),"object"==typeof e.options.handlers&&t.each(e.options.handlers,function(t,a){var n;"string"==typeof a&&i[a]?n=i[a]:"function"==typeof a&&(n=a),h.on(t,function(t){n&&n.call(h,t,e.data[s])})})}),this.element.removeAttr("style"),this.options.edit&&this.alterDOM(),this.updateDOM()},a.prototype.updateDOM=function(){var e=this;this.wrapper.removeAttr("style").css({height:this.element.height(),width:this.element.width()}),this.wrapper.find("span").each(function(i,a){var n=t(a),s=n.attr("data-x")*e.element.width(),o=n.attr("data-y")*e.element.height();n.hasClass("taggd-item")?n.css({left:s-n.outerWidth(!0)/2,top:o-n.outerHeight(!0)/2}):n.hasClass("taggd-item-hover")&&("center"===e.options.align.x?s-=n.outerWidth(!0)/2:"right"===e.options.align.x&&(s-=n.outerWidth(!0)),"center"===e.options.align.y?o-=n.outerHeight(!0)/2:"bottom"===e.options.align.y&&(o-=n.outerHeight(!0)),n.attr("data-align",n.outerWidth(!0)),n.css({left:s+e.options.offset.left,top:o+e.options.offset.top}))})},t.fn.taggd=function(t,e){return new a(this,t,e)}}(jQuery);